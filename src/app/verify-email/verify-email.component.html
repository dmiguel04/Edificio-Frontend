<div class="verify-container">
  <div class="verify-card">
    <!-- Header minimalista -->
    <div class="header">
      <h1>Verificar Email</h1>
      <p class="subtitle">
        Código enviado a <span class="email">{{ email }}</span>
      </p>
    </div>

    <!-- Alertas -->
    <div *ngIf="message" class="alert success">
      {{ message }}
    </div>
    <div *ngIf="error" class="alert error">
      {{ error }}
    </div>

    <!-- Formulario principal -->
    <form [formGroup]="verifyForm" (ngSubmit)="onSubmit()" class="form">
      <div class="code-input-container">
        <div class="code-digits">
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit1
            (input)="onDigitInput($event, 0, digit2)"
            (keydown)="onKeyDown($event, 0, null, digit2)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit2
            (input)="onDigitInput($event, 1, digit3)"
            (keydown)="onKeyDown($event, 1, digit1, digit3)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit3
            (input)="onDigitInput($event, 2, digit4)"
            (keydown)="onKeyDown($event, 2, digit2, digit4)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit4
            (input)="onDigitInput($event, 3, digit5)"
            (keydown)="onKeyDown($event, 3, digit3, digit5)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit5
            (input)="onDigitInput($event, 4, digit6)"
            (keydown)="onKeyDown($event, 4, digit4, digit6)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
          <input 
            type="text" 
            maxlength="1" 
            class="digit-input"
            #digit6
            (input)="onDigitInput($event, 5, null)"
            (keydown)="onKeyDown($event, 5, digit5, null)"
            [class.error]="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched"
          >
        </div>
        <p class="input-label">Código de 6 dígitos</p>
      </div>

      <div *ngIf="verifyForm.get('codigo')?.invalid && verifyForm.get('codigo')?.touched" class="error-text">
        <span *ngIf="verifyForm.get('codigo')?.errors?.['required']">
          Código requerido
        </span>
        <span *ngIf="verifyForm.get('codigo')?.errors?.['pattern']">
          Debe tener 6 dígitos
        </span>
      </div>

      <!-- Input oculto para el FormControl -->
      <input 
        type="hidden" 
        formControlName="codigo"
      >

      <button
        type="submit"
        class="btn-primary"
        [disabled]="!verifyForm.valid || isLoading"
      >
        <span *ngIf="isLoading" class="loading-spinner"></span>
        {{ isLoading ? 'Verificando...' : 'Verificar' }}
      </button>
    </form>

    <!-- Sección de reenvío -->
    <div class="resend-section">
      <p class="resend-info">¿No lo recibiste?</p>
      <button
        type="button"
        class="btn-secondary"
        (click)="reenviarCodigo()"
        [disabled]="resendLoading || resendCooldown > 0"
      >
        <span *ngIf="resendLoading" class="loading-spinner"></span>
        <span *ngIf="!resendLoading && resendCooldown === 0">Reenviar</span>
        <span *ngIf="!resendLoading && resendCooldown > 0">{{ resendCooldown }}s</span>
      </button>
    </div>

    <!-- Navegación -->
    <div class="nav-links">
      <button type="button" class="link" (click)="goToLogin()">Ir al Login</button>
      <span class="separator">•</span>
      <button type="button" class="link" (click)="goToRegister()">Volver al Registro</button>
    </div>
  </div>
</div>